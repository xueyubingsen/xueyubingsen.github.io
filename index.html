<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>力导向图 Demo</title>
    <script src="https://unpkg.com/@antv/g6@5/dist/g6.min.js"></script>
    <style>
        body {
            margin: 0;
            overflow: hidden;
        }
        #container {
            width: 100%;
            height: 100vh;
        }
    </style>
</head>
<body>
    <div id="container"></div>
    <script>
        // 创建50个节点
        const nodes = [];
        for (let i = 0; i < 50; i++) {
            nodes.push({
                id: `${i}`,
                label: `Node ${i}`,
                size: 10, // 默认大小
                x: Math.random() * 600, // 随机位置
                y: Math.random() * 600
            });
        }

        // 随机连接节点
        const edges = [];
        for (let i = 0; i < 50; i++) {
            const targetNodeCount = Math.floor(Math.random() * 5); // 每个节点最多连接5个其他节点
            for (let j = 0; j < targetNodeCount; j++) {
                const target = Math.floor(Math.random() * 50);
                if (i !== target) {
                    edges.push({
                        source: `${i}`,
                        target: `${target}`
                    });
                }
            }
        }

        // 创建力导向图实例
        const graph = new G6.Graph({
            container: 'container',
            width: window.innerWidth,
            height: window.innerHeight,
            modes: {
                default: ['drag-node']  // 启用节点拖拽
            },
            layout: {
                type: 'force',  // 力导向布局
                preventOverlap: true,
                nodeStrength: -30,
                edgeStrength: 0.1,
                gravity: 30
            },
            defaultNode: {
                shape: 'circle',
                size: [10],  // 初始节点大小
                style: {
                    fill: '#5B8FF9',
                    stroke: '#1D78FF'
                }
            },
            defaultEdge: {
                style: {
                    stroke: '#ccc',
                    lineWidth: 1
                }
            },
            nodeStateStyles: {
                hover: {
                    fill: '#F56C6C',
                    stroke: '#F56C6C'
                }
            },
            // 更新节点的大小，使得入度更多的节点变大
            onAfterLayout() {
                const nodeMap = new Map();
                edges.forEach(edge => {
                    const targetId = edge.target;
                    if (!nodeMap.has(targetId)) {
                        nodeMap.set(targetId, 0);
                    }
                    nodeMap.set(targetId, nodeMap.get(targetId) + 1);
                });

                graph.getNodes().forEach(node => {
                    const nodeId = node.getID();
                    const size = nodeMap.get(nodeId) || 10; // 入度越多，节点越大
                    graph.updateItem(node, {
                        size: Math.min(size + 5, 50) // 最大大小为50
                    });
                });
            }
        });

        // 添加节点和边
        graph.data({
            nodes,
            edges
        });
        graph.render();
    </script>
</body>
</html>
